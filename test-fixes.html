<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Test Fixes - Image Controls & File Sizes</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 6px; }
        .test-section h2 { margin-top: 0; color: #333; }
        .result { margin: 10px 0; padding: 10px; background: #f9f9f9; border-radius: 4px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        button { padding: 8px 16px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>Test Fixes - Image Controls & File Sizes</h1>
    
    <div class="test-section">
        <h2>1. Categories Structure Test</h2>
        <button onclick="testCategoriesStructure()">Test Categories</button>
        <div id="categories-result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Image Dimensions Test</h2>
        <button onclick="testImageDimensions()">Test Image Dimensions</button>
        <div id="image-result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. File Size Test</h2>
        <button onclick="testFileSizes()">Test File Sizes</button>
        <div id="filesize-result"></div>
    </div>

    <!-- Include all necessary scripts in correct order -->
    <script src="utils/helpers.js"></script>
    <script src="data/names-data.js"></script>
    <script src="data/saudi-data.js"></script>
    <script src="ui/categories-structure.js"></script>
    <script src="generators/personal-generators.js"></script>
    <script src="generators/file-media-generators.js"></script>
    <script src="generators/image-url-generators.js"></script>

    <script>
        function testCategoriesStructure() {
            const resultDiv = document.getElementById('categories-result');
            
            if (typeof categoriesWithSubTabs !== 'undefined') {
                const imagesCategory = categoriesWithSubTabs.find(cat => cat.title === 'Images & Avatars');
                if (imagesCategory) {
                    resultDiv.innerHTML = `
                        <div class="result success">
                            ✅ SUCCESS: Found "Images & Avatars" category with ${imagesCategory.subTabs.length} sub-tabs:
                            <ul>
                                ${imagesCategory.subTabs.map(tab => `<li>${tab.title} (${tab.fields.length} fields)</li>`).join('')}
                            </ul>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="result error">❌ ERROR: "Images & Avatars" category not found</div>`;
                }
            } else {
                resultDiv.innerHTML = `<div class="result error">❌ ERROR: categoriesWithSubTabs not loaded</div>`;
            }
        }
        
        function testImageDimensions() {
            const resultDiv = document.getElementById('image-result');
            
            try {
                // Test setting dimensions
                if (typeof setImageDimensions === 'function') {
                    setImageDimensions(800, 600);
                    const dims = getImageDimensions();
                    
                    if (dims.width === 800 && dims.height === 600) {
                        // Test image generation
                        const placeholderUrl = imageUrlGenerators.placeholderImage();
                        const expectedUrl = 'https://via.placeholder.com/800x600';
                        
                        if (placeholderUrl === expectedUrl) {
                            resultDiv.innerHTML = `
                                <div class="result success">
                                    ✅ SUCCESS: Image dimensions working correctly<br>
                                    - Set dimensions: 800x600<br>
                                    - Generated URL: ${placeholderUrl}<br>
                                    - Aspect ratio: ${imageUrlGenerators.imageAspectRatio()}
                                </div>
                            `;
                        } else {
                            resultDiv.innerHTML = `
                                <div class="result error">
                                    ❌ ERROR: URL generation incorrect<br>
                                    Expected: ${expectedUrl}<br>
                                    Got: ${placeholderUrl}
                                </div>
                            `;
                        }
                    } else {
                        resultDiv.innerHTML = `<div class="result error">❌ ERROR: Dimension setting failed. Got: ${dims.width}x${dims.height}</div>`;
                    }
                } else {
                    resultDiv.innerHTML = `<div class="result error">❌ ERROR: setImageDimensions function not available</div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">❌ ERROR: ${error.message}</div>`;
            }
        }
        
        function testFileSizes() {
            const resultDiv = document.getElementById('filesize-result');
            
            try {
                // Test different file types
                const testResults = [];
                
                // Generate multiple files to test size consistency
                for (let i = 0; i < 5; i++) {
                    // Reset shared data for each test
                    if (typeof resetSharedData === 'function') {
                        resetSharedData();
                    }
                    
                    const fileName = fileMediaGenerators.fileName();
                    const fileSize = fileMediaGenerators.fileSize();
                    const fileSizeBytes = fileMediaGenerators.fileSizeBytes();
                    const fileType = fileMediaGenerators.fileType();
                    const extension = fileMediaGenerators.fileExtension();
                    
                    testResults.push({
                        fileName,
                        fileSize,
                        fileSizeBytes,
                        fileType,
                        extension
                    });
                }
                
                let html = '<div class="result success">✅ SUCCESS: File size generation working<br><br>';
                testResults.forEach((result, index) => {
                    html += `
                        <strong>Test ${index + 1}:</strong><br>
                        - File: ${result.fileName}<br>
                        - Type: ${result.fileType} (.${result.extension})<br>
                        - Size: ${result.fileSize}<br>
                        - Bytes: ${result.fileSizeBytes}<br><br>
                    `;
                });
                html += '</div>';
                
                resultDiv.innerHTML = html;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">❌ ERROR: ${error.message}</div>`;
            }
        }
        
        // Run initial tests
        window.onload = function() {
            console.log('Testing fixes...');
            testCategoriesStructure();
        };
    </script>
</body>
</html>