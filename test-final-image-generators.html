<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Final Image Generators Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 6px; }
        .test-section h2 { margin-top: 0; color: #333; }
        .result { margin: 10px 0; padding: 10px; background: #f9f9f9; border-radius: 4px; }
        .success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        button { padding: 8px 16px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .image-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px; margin: 15px 0; }
        .image-item { border: 1px solid #ddd; border-radius: 6px; padding: 10px; }
        .image-item img { max-width: 100%; height: auto; border: 1px solid #ccc; border-radius: 4px; }
        .image-item h4 { margin: 0 0 8px 0; color: #333; }
        .image-item a { font-size: 11px; color: #666; word-break: break-all; }
    </style>
</head>
<body>
    <h1>üéâ Final Image Generators Test</h1>
    
    <div class="test-section">
        <h2>1. Generator Registration Check</h2>
        <button onclick="checkRegistration()">Check Registration</button>
        <div id="registration-result"></div>
    </div>
    
    <div class="test-section">
        <h2>2. Dimension Controls Test</h2>
        <button onclick="testDimensions()">Test Dimensions</button>
        <div id="dimensions-result"></div>
    </div>
    
    <div class="test-section">
        <h2>3. Image Generation Test</h2>
        <button onclick="generateImages()">Generate Images</button>
        <div id="images-result"></div>
    </div>

    <!-- Load scripts in correct order -->
    <script src="data/names-data.js"></script>
    <script src="data/saudi-data.js"></script>
    <script src="utils/helpers.js"></script>
    <script src="generators/personal-generators.js"></script>
    <script src="generators/image-url-generators.js"></script>
    <script src="shared.js"></script>

    <script>
        function checkRegistration() {
            const resultDiv = document.getElementById('registration-result');
            
            setTimeout(() => {
                let html = '';
                
                // Check window.imageUrlGenerators
                if (typeof window.imageUrlGenerators === 'object') {
                    const count = Object.keys(window.imageUrlGenerators).length;
                    html += `<div class="result success">‚úÖ window.imageUrlGenerators: ${count} functions</div>`;
                } else {
                    html += '<div class="result error">‚ùå window.imageUrlGenerators not available</div>';
                }
                
                // Check window.generators (from shared.js)
                if (typeof window.generators === 'object') {
                    const totalCount = Object.keys(window.generators).length;
                    const imageCount = Object.keys(window.generators).filter(key => 
                        key.includes('image') || key.includes('avatar') || key.includes('placeholder') || 
                        key.includes('picsum') || key.includes('unsplash') || key.includes('qr') || key.includes('chart')
                    ).length;
                    html += `<div class="result success">‚úÖ window.generators: ${totalCount} total, ${imageCount} image-related</div>`;
                } else {
                    html += '<div class="result error">‚ùå window.generators not available</div>';
                }
                
                // Check dimension functions
                if (typeof setImageDimensions === 'function') {
                    html += '<div class="result success">‚úÖ setImageDimensions function available</div>';
                } else {
                    html += '<div class="result error">‚ùå setImageDimensions function missing</div>';
                }
                
                if (typeof getImageDimensions === 'function') {
                    html += '<div class="result success">‚úÖ getImageDimensions function available</div>';
                } else {
                    html += '<div class="result error">‚ùå getImageDimensions function missing</div>';
                }
                
                resultDiv.innerHTML = html;
            }, 100);
        }
        
        function testDimensions() {
            const resultDiv = document.getElementById('dimensions-result');
            
            try {
                // Test dimension setting
                setImageDimensions(600, 400);
                const dims = getImageDimensions();
                
                if (dims.width === 600 && dims.height === 400) {
                    resultDiv.innerHTML = `
                        <div class="result success">
                            ‚úÖ Dimension controls working correctly!<br>
                            Set: 600√ó400, Got: ${dims.width}√ó${dims.height}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="result error">
                            ‚ùå Dimension setting failed<br>
                            Expected: 600√ó400, Got: ${dims.width}√ó${dims.height}
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">‚ùå Error: ${error.message}</div>`;
            }
        }
        
        function generateImages() {
            const resultDiv = document.getElementById('images-result');
            
            try {
                // Set dimensions for testing
                setImageDimensions(300, 200);
                
                const imageTests = [
                    { name: 'Placeholder Image', func: 'placeholderImage' },
                    { name: 'Placeholder with Text', func: 'placeholderImageWithText' },
                    { name: 'Lorem Picsum', func: 'loremPicsumImage' },
                    { name: 'Unsplash Image', func: 'unsplashImage' },
                    { name: 'QR Code', func: 'qrCodeUrl' },
                    { name: 'Chart', func: 'chartUrl' },
                    { name: 'UI Avatar', func: 'uiAvatar' },
                    { name: 'Country Flag', func: 'countryFlag' }
                ];
                
                let html = '<div class="result success">‚úÖ Generated Images (300√ó200):</div>';
                html += '<div class="image-grid">';
                
                imageTests.forEach(test => {
                    if (typeof window.generators[test.func] === 'function') {
                        try {
                            const url = window.generators[test.func]();
                            html += `
                                <div class="image-item">
                                    <h4>${test.name}</h4>
                                    <img src="${url}" alt="${test.name}" onload="console.log('${test.name} loaded successfully')" onerror="console.error('${test.name} failed to load')">
                                    <br><a href="${url}" target="_blank">${url}</a>
                                </div>
                            `;
                        } catch (error) {
                            html += `
                                <div class="image-item">
                                    <h4>${test.name}</h4>
                                    <div class="result error">Generation failed: ${error.message}</div>
                                </div>
                            `;
                        }
                    } else {
                        html += `
                            <div class="image-item">
                                <h4>${test.name}</h4>
                                <div class="result error">Function not found</div>
                            </div>
                        `;
                    }
                });
                
                html += '</div>';
                resultDiv.innerHTML = html;
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error">‚ùå Image generation failed: ${error.message}</div>`;
            }
        }
        
        // Auto-run tests
        window.onload = function() {
            setTimeout(() => {
                checkRegistration();
            }, 200);
        };
    </script>
</body>
</html>